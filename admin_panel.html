<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StreamX Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    font-family:'Space Grotesk',sans-serif;
    background:linear-gradient(120deg,#e0e7ff,#f0f4ff);
    min-height:100vh;
    padding:2rem;
    display:flex;
    justify-content:center;
  }
  .card {
    background:#fff;
    border-radius:1rem;
    box-shadow:0 10px 25px rgba(0,0,0,0.05);
  }
  input,textarea,select {
    border:1px solid #e5e7eb;
    background:#f9fafb;
    color:#374151;
  }
  input:focus,textarea:focus,select:focus {
    border-color:#6366f1;
    outline:none;
    box-shadow:0 0 0 2px rgba(99,102,241,0.2);
  }
  .btn {
    background:#6366f1;
    color:white;
  }
  .btn:hover {
    background:#4f46e5;
  }
  .tab-btn-active {
    background:#6366f1 !important;
    color:white !important;
  }
  .preview img{
    object-fit:contain;
    max-height:400px;
    border-radius:.5rem;
    border:1px solid #e5e7eb;
  }
  .alert{
    position:fixed;top:1rem;right:1rem;z-index:50;
    padding:.75rem 1.25rem;border-radius:.5rem;
    font-weight:600;
  }
</style>
</head>
<body>
<div id="alertBox" class="hidden alert"></div>

<div class="w-full max-w-5xl space-y-6">
  <h1 class="text-3xl font-bold text-center text-gray-800">StreamX Admin Panel</h1>

  <!-- Tabs -->
  <div class="flex space-x-3 justify-center">
    <button class="tab-btn px-4 py-2 rounded-md bg-gray-100 text-gray-700 tab-btn-active" data-tab="live">Live Channels</button>
    <button class="tab-btn px-4 py-2 rounded-md bg-gray-100 text-gray-700" data-tab="movies">Movies</button>
    <button class="tab-btn px-4 py-2 rounded-md bg-gray-100 text-gray-700" data-tab="series">Series</button>
  </div>

  <!-- Live -->
  <div id="live" class="tab-panel card p-6">
    <h2 class="text-xl font-semibold mb-4 text-gray-700">Add New Live Channel</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="preview flex items-center justify-center">
        <img id="liveLogoPreview" class="w-full">
      </div>
      <form id="liveForm" class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4">
        <input name="id" placeholder="ID (unique)*" class="p-2 rounded-md" required>
        <input name="name" placeholder="Channel Name" class="p-2 rounded-md">
        <input name="logo" placeholder="Logo URL" class="p-2 rounded-md md:col-span-2" id="liveLogo">
        <select name="category" class="p-2 rounded-md">
          <option value="">Select Category</option><option>News</option><option>Sports</option>
          <option>Entertainment</option><option>Kids</option><option>Music</option>
        </select>
        <input name="url" placeholder="Stream URL" class="p-2 rounded-md md:col-span-2">
        <textarea name="description" placeholder="Description" class="p-2 rounded-md md:col-span-2"></textarea>
        <button class="col-span-2 btn px-4 py-2 rounded-md transition">Add Channel</button>
      </form>
    </div>
  </div>

  <!-- Movies -->
  <div id="movies" class="tab-panel hidden card p-6">
    <h2 class="text-xl font-semibold mb-4 text-gray-700">Add New Movie</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="preview flex items-center justify-center">
        <img id="movieThumbPreview" class="w-full">
      </div>
      <form id="moviesForm" class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4">
        <input name="id" placeholder="ID (unique)*" class="p-2 rounded-md" required>
        <input name="title" placeholder="Title *" class="p-2 rounded-md" required>
        <select name="category" class="p-2 rounded-md">
          <option value="">Select Category</option><option>Action</option><option>Comedy</option>
          <option>Drama</option><option>Horror</option>
        </select>
        <input name="genre" placeholder="Genre" class="p-2 rounded-md">
        <input name="thumbnail" placeholder="Thumbnail URL" class="p-2 rounded-md md:col-span-2" id="movieThumb">
        <input name="url" placeholder="Stream URL" class="p-2 rounded-md md:col-span-2">
        <textarea name="description" placeholder="Description" class="p-2 rounded-md md:col-span-2"></textarea>
        <button class="col-span-2 btn px-4 py-2 rounded-md transition">Add Movie</button>
      </form>
    </div>
  </div>

  <!-- Series -->
  <div id="series" class="tab-panel hidden card p-6">
    <h2 class="text-xl font-semibold mb-4 text-gray-700">Add New Series</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="preview flex flex-col space-y-4 items-center">
        <img id="seriesThumbPreview" class="w-full">
        <img id="seriesBannerPreview" class="w-full">
      </div>
      <form id="seriesForm" class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4">
        <input name="id" placeholder="ID (unique)*" class="p-2 rounded-md" required>
        <input name="title" placeholder="Title *" class="p-2 rounded-md" required>
        <input name="genre" placeholder="Genre" class="p-2 rounded-md">
        <input name="language" placeholder="Language" class="p-2 rounded-md">
        <select name="category" class="p-2 rounded-md">
          <option value="">Select Category</option><option>Drama</option><option>Action</option>
          <option>Comedy</option><option>Thriller</option>
        </select>
        <input name="rating" placeholder="Rating" class="p-2 rounded-md">
        <input name="releaseyear" placeholder="Release Year" class="p-2 rounded-md">
        <input name="thumbnail" placeholder="Thumbnail URL" class="p-2 rounded-md md:col-span-2" id="seriesThumb">
        <input name="banner" placeholder="Banner URL" class="p-2 rounded-md md:col-span-2" id="seriesBanner">
        <textarea name="description" placeholder="Description" class="p-2 rounded-md md:col-span-2"></textarea>
        <button class="col-span-2 btn px-4 py-2 rounded-md transition">Add Series</button>
      </form>
    </div>
  </div>
</div>

<!-- everything above your <script> stays the same -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCFa9IcxtYMXw0jmLny9m4m9nLEbx6KJcU",
    authDomain: "sample-streamx.firebaseapp.com",
    projectId: "sample-streamx",
    storageBucket: "sample-streamx.firebasestorage.app",
    messagingSenderId: "134980648814",
    appId: "1:134980648814:web:fa817a9c3e239e7755cb7f",
    measurementId: "G-EC6VVWTEG4"
  };

  const app = initializeApp(firebaseConfig);
  // analytics
  const analytics = getAnalytics(app);
  const db = getFirestore(app);

  // Tabs
  document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('tab-btn-active'));
      btn.classList.add('tab-btn-active');
      document.querySelectorAll('.tab-panel').forEach(p=>p.classList.add('hidden'));
      document.getElementById(btn.getAttribute('data-tab')).classList.remove('hidden');
    });
  });

  // Previews
  const previews = {
    liveLogo:'liveLogoPreview',
    movieThumb:'movieThumbPreview',
    seriesThumb:'seriesThumbPreview',
    seriesBanner:'seriesBannerPreview'
  };
  Object.entries(previews).forEach(([inputId,imgId])=>{
    const inp=document.getElementById(inputId);
    inp?.addEventListener('input',e=>{
      document.getElementById(imgId).src=e.target.value;
    });
  });

  // Alert function
  function showAlert(msg, colorClass){
    const alertBox=document.getElementById('alertBox');
    alertBox.textContent=msg;
    alertBox.className=`alert ${colorClass}`;
    alertBox.classList.remove('hidden');
  }
  function hideAlert(){document.getElementById('alertBox').classList.add('hidden')}

  // show preview of saved doc under the form
  function showSavedPreview(containerId, data){
    let previewContainer=document.getElementById(containerId+'-preview');
    if(!previewContainer){
      previewContainer=document.createElement('div');
      previewContainer.id=containerId+'-preview';
      previewContainer.className='mt-4';
      document.getElementById(containerId+'Form').after(previewContainer);
    }
    previewContainer.innerHTML=`
      <div class="mt-4 p-4 border rounded-md bg-gray-50">
        <h3 class="font-semibold text-gray-700 mb-2">Just saved:</h3>
        <div class="flex items-center space-x-4">
          ${data.logo||data.thumbnail?`<img src="${data.logo||data.thumbnail}" class="h-16 w-16 object-contain rounded">`:''}
          <div>
            <p class="text-gray-800">${data.name||data.title}</p>
            <p class="text-gray-500 text-sm">${data.category||''}</p>
          </div>
        </div>
      </div>
    `;
  }

  async function saveData(collectionName, data, formId) {
    // start loading
    showAlert('Uploading… Please wait','bg-blue-500 text-white');
    try {
      await setDoc(doc(db, collectionName, data.id), data);
      showAlert(`✅ ${collectionName} added successfully!`,'bg-green-500 text-white');
      showSavedPreview(formId,data);
      setTimeout(hideAlert,3000);
      return true;
    } catch(err){
      console.error(err);
      showAlert(`❌ Failed to add ${collectionName}: ${err.message}`,'bg-red-500 text-white');
      setTimeout(hideAlert,4000);
      return false;
    }
  }

  // Forms
  document.getElementById('liveForm').addEventListener('submit',async e=>{
    e.preventDefault();
    const data=Object.fromEntries(new FormData(e.target).entries());
    if(await saveData('channels',data,'live')) e.target.reset();
  });
  document.getElementById('moviesForm').addEventListener('submit',async e=>{
    e.preventDefault();
    const data=Object.fromEntries(new FormData(e.target).entries());
    if(await saveData('movies',data,'movies')) e.target.reset();
  });
  document.getElementById('seriesForm').addEventListener('submit',async e=>{
    e.preventDefault();
    const data=Object.fromEntries(new FormData(e.target).entries());
    if(await saveData('series',data,'series')) e.target.reset();
  });
</script>

</body>
</html>
