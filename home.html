<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>StreamX</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"
    />

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <!-- Auth script -->
    <script src="auth.js"></script>

    <style>
      body {
        margin: 0;

        background: #0d0d0d;

        font-family: "Space Grotesk", sans-serif;

        color: #fff;

        overflow-x: hidden;
      }

      /* HERO SLIDER */

      .hero-slider .hero-slide {
        position: relative;

        height: 75vh;

        background-size: cover;

        background-position: center;

        display: flex !important;

        align-items: center;

        padding: 4rem 2rem;
      }

      .hero-slide::before {
        content: "";

        position: absolute;

        inset: 0;

        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.75),
          rgba(0, 0, 0, 0.1)
        );

        z-index: 0;
      }

      .hero-content {
        max-width: 600px;

        z-index: 1;

        position: relative;
      }

      .hero-logo {
        max-width: 300px;

        margin-bottom: 1rem;
      }

      .hero-meta {
        font-size: 0.9rem;

        color: #ccc;

        margin-bottom: 0.5rem;
      }

      .hero-desc {
        font-size: 1rem;

        line-height: 1.4;
      }

      .hero-buttons {
        display: flex;

        gap: 1rem;

        margin-top: 1rem;
      }

      .hero-buttons button {
        display: flex;

        align-items: center;

        gap: 0.4rem;

        padding: 0.7rem 1.4rem;

        border: none;

        border-radius: 4px;

        cursor: pointer;

        font-weight: 600;

        font-size: 1rem;

        transition: background 0.2s ease;
      }

      .btn-play {
        background: #00e5ff;

        color: #000;
      }

      .btn-info,
      .btn-add {
        background: rgba(255, 255, 255, 0.15);

        color: #fff;
      }

      .btn-info:hover,
      .btn-add:hover {
        background: rgba(255, 255, 255, 0.25);
      }

      .btn-play:hover {
        background: #00cce0;
      }

      /* SECTION TITLES */

      .section-title {
        padding: 1.5rem 2rem 0.8rem;

        font-size: 1.4rem;

        font-weight: 700;

        color: #00e5ff;

        border-left: 4px solid #00e5ff;

        padding-left: 10px;
      }

      /* CARDS */

      .movie-card {
        position: relative;

        border-radius: 6px;

        overflow: hidden;

        cursor: pointer;

        transition: transform 0.25s ease, box-shadow 0.25s ease;

        margin: 0;
      }

      .movie-carousel .slick-slide {
        padding: 0 8px;
      }

      .movie-card:hover {
        transform: scale(1.05);

        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.6);
      }

      .movie-card img {
        width: 100%;

        display: block;

        border-radius: 6px;
      }

      .overlay {
        position: absolute;

        inset: 0;

        background: rgba(0, 0, 0, 0.7);

        opacity: 0;

        display: flex;

        justify-content: center;

        align-items: center;

        text-align: center;

        transition: opacity 0.3s ease;

        z-index: 2;
      }

      .movie-card:hover .overlay {
        opacity: 1;
      }

      .overlay-content {
        color: #00e5ff;

        font-weight: 600;

        font-size: 1rem;

        padding: 5px 10px;
      }

      /* Slick arrows */

      .slick-prev,
      .slick-next {
        position: absolute;

        top: 50%;

        transform: translateY(-50%);

        width: 40px;

        height: 60px;

        border-radius: 4px;

        z-index: 10;

        display: flex !important;

        justify-content: center;

        align-items: center;

        cursor: pointer;

        transition: all 0.3s ease;
      }

      .slick-prev {
        left: 10px;
      }

      .slick-next {
        right: 10px;
      }

      .slick-prev:before,
      .slick-next:before {
        color: white;

        font-size: 28px;

        opacity: 1;

        transition: all 0.3s ease;
      }

      .slick-prev:hover:before,
      .slick-next:hover:before {
        color: #00e5ff;

        font-size: 34px;
      }

      /* Modal */

      .modal {
        position: fixed;

        top: 0;

        left: 0;

        width: 100%;

        height: 100%;

        background: rgba(0, 0, 0, 0.85);

        display: flex;

        align-items: center;

        justify-content: center;

        z-index: 4000;
      }

      .modal.hidden {
        display: none;
      }

      .modal-content {
        background: #181b25;

        border-radius: 16px;

        width: 96%;

        max-width: 800px;

        max-height: 85vh;

        overflow-y: auto;

        padding: 32px 24px 24px;

        position: relative;

        box-shadow: 0 6px 36px #0007;
      }

      .close-btn {
        position: absolute;

        top: 18px;

        right: 28px;

        font-size: 2rem;

        cursor: pointer;

        color: #fff;

        background: transparent;

        border: none;

        z-index: 10;
      }

      #modal-series-info h2 {
        font-size: 2rem;

        font-weight: 700;

        color: #00e5ff;

        margin-bottom: 0.5rem;
      }

      #modal-series-info p {
        font-size: 1rem;

        color: #ddd;

        margin: 0.3rem 0;
      }

      .season-dropdown {
        display: block;

        margin: 1rem 0;

        background: #222;

        color: #fff;

        border: 1px solid #333;

        padding: 0.5rem 1rem;

        border-radius: 4px;
      }

      .episodes-container {
        display: grid;

        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));

        gap: 16px;
      }

      .episode {
        cursor: pointer;

        background: #111;

        border-radius: 6px;

        overflow: hidden;

        display: flex;

        flex-direction: column;

        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }

      .episode:hover {
        transform: scale(1.03);

        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
      }

      .episode-thumb {
        width: 100%;

        aspect-ratio: 16/9;

        object-fit: cover;
      }

      .episode-details {
        padding: 0.5rem 0.8rem;
      }

      .episode-title {
        font-weight: 600;

        color: #00e5ff;

        font-size: 0.9rem;

        margin-bottom: 0.2rem;
      }

      .episode-desc {
        font-size: 0.8rem;

        color: #ccc;
      }

      /* Live Grid */

      .cards-grid {
        display: grid;

        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));

        gap: 16px;

        padding: 0 2rem 2rem;
      }

      .live-card {
        position: relative;

        aspect-ratio: 2/3;

        background-color: #111;

        display: flex;

        justify-content: center;

        align-items: center;

        overflow: hidden;

        border-radius: 8px;

        cursor: pointer;
      }

      .live-card::before {
        content: "";

        position: absolute;

        inset: 0;

        background-size: cover;

        background-position: center;

        background-image: var(--bg);

        filter: blur(15px) brightness(0.4);

        transform: scale(1.2);

        z-index: 1;
      }

      .live-card img {
        position: relative;

        z-index: 2;

        max-width: 70%;

        max-height: 70%;

        object-fit: contain;

        display: block;
      }

      .live-card .overlay {
        position: absolute;

        inset: 0;

        background: rgba(0, 0, 0, 0.5);

        opacity: 0;

        z-index: 3;

        display: flex;

        justify-content: center;

        align-items: center;

        text-align: center;

        transition: opacity 0.3s ease;
      }

      .live-card:hover .overlay {
        opacity: 1;
      }

      .overlay-content div:first-child {
        font-weight: 600;

        font-size: 1rem;

        color: #00e5ff;
      }

      .overlay-content div:last-child {
        font-size: 0.8rem;

        color: #ccc;
      }

      .livetv-container {
        margin: 2rem 0;
      }

      .section-title {
        padding: 1.5rem 2rem 0.8rem;

        font-size: 1.4rem;

        font-weight: 700;

        color: #00e5ff;

        border-left: 4px solid #00e5ff;

        padding-left: 10px;
      }

      .card-grid {
        display: grid;

        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));

        gap: 16px;

        padding: 1rem 2rem;
      }

      .tv-card {
        position: relative;

        background: #111;

        border-radius: 8px;

        overflow: hidden;

        cursor: pointer;
      }

      .tv-thumbnail img {
        width: 100%;

        aspect-ratio: 16/9;

        object-fit: contain;
      }

      .tv-overlay {
        padding: 0.5rem;

        color: #00e5ff;

        font-size: 0.85rem;
      }

      .channel-hover-info {
        display: none;
      }

      .tv-card:hover .channel-hover-info {
        display: block;

        padding: 0.5rem;

        background: rgba(0, 0, 0, 0.7);

        color: #fff;
      }
    </style>
  </head>

  <body>
    <!-- Header -->

    <div id="header-placeholder"></div>

    <!-- Hero Slider -->

    <div class="hero-slider"></div>

    <!-- Movies Carousels -->

    <div id="moviesSections"></div>

    <!-- Series Carousel -->

    <div class="section-title">Series</div>

    <div class="movie-carousel" id="seriesCarousel"></div>

    <!-- Live Channels Grid -->

    <!-- Live Channels Grid -->

    <div id="livetv-sections">
      <div id="livesContainer" class="cards-grid"></div>
    </div>

    <!-- Footer -->

    <div id="footer-container"></div>

    <!-- Series Modal -->

    <div id="modal" class="modal hidden" tabindex="-1">
      <div class="modal-content">
        <button id="closeModalBtn" class="close-btn">&times;</button>

        <div id="modal-series-info"></div>

        <div id="modal-seasons"></div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <script src="js/movies/moviesdata.js"></script>

    <script src="js/series/seriesdata.js"></script>

    <script src="js/livetv/live.js"></script>

    <script>
      // Header/Footer

      fetch("header.html")
        .then((r) => (r.ok ? r.text() : Promise.reject()))
        .then(
          (h) => (document.getElementById("header-placeholder").innerHTML = h)
        );

      fetch("footer.html")
        .then((r) => (r.ok ? r.text() : Promise.reject()))
        .then(
          (h) => (document.getElementById("footer-container").innerHTML = h)
        );
    </script>

    <script type="module">
      import { heroMovies } from "./js/data.js";

      // HERO SLIDER

      const heroContainer = document.querySelector(".hero-slider");

      heroContainer.innerHTML = heroMovies
        .map(
          (m) => `

<div class="hero-slide" style="background-image:url('${m.image}')">

<div class="hero-content">

<img src="${m.logo}" alt="${m.title}" class="hero-logo">

<div class="hero-meta">${m.language} | ${m.genres}</div>

<div class="hero-desc">${m.description}</div>

<div class="hero-buttons">

<button class="btn-play"><span class="material-icons">play_arrow</span>Play</button>

<button class="btn-info"><span class="material-icons">info</span>More Info</button>

<button class="btn-add"><span class="material-icons">add</span>My List</button>

</div>

</div>

</div>

`
        )
        .join("");

      $(".hero-slider").slick({
        autoplay: true,
        autoplaySpeed: 5000,
        arrows: true,
        dots: true,
        fade: true,
      });

      // Build carousel helper

      function buildCarousel(containerId, items, clickCallback) {
        const cont = document.getElementById(containerId);

        cont.innerHTML = items
          .map(
            (m) => `

<div class="movie-card">

<img src="${m.thumbnail || m.logo}" alt="${m.title || m.name}">

<div class="overlay"><div class="overlay-content">${
              m.title || m.name
            }</div></div>

</div>

`
          )
          .join("");

        if (clickCallback)
          cont
            .querySelectorAll(".movie-card")
            .forEach((el, idx) =>
              el.addEventListener("click", () => clickCallback(items[idx]))
            );

        $(`#${containerId}`).slick({
          slidesToShow: 6,
          slidesToScroll: 2,
          infinite: true,
          arrows: true,
          dots: false,
          swipeToSlide: true,

          responsive: [
            { breakpoint: 1280, settings: { slidesToShow: 5 } },
            { breakpoint: 1024, settings: { slidesToShow: 4 } },
            { breakpoint: 768, settings: { slidesToShow: 3 } },
            { breakpoint: 480, settings: { slidesToShow: 2 } },
          ],
        });
      }

      // Movies sections

      const moviesSections = document.getElementById("moviesSections");

      const genres = [
        ...new Set(
          movies.flatMap((m) => m.genre.split(",").map((g) => g.trim()))
        ),
      ];

      genres.forEach((g) => {
        const id = `carousel_${g.replace(/\s+/g, "_")}`;

        moviesSections.insertAdjacentHTML(
          "beforeend",
          `<div class="section-title">${g}</div><div class="movie-carousel" id="${id}"></div>`
        );

        buildCarousel(
          id,
          movies.filter((m) => m.genre.includes(g)),
          (m) => window.open(m.url, "_blank")
        );
      });

      // Series modal

      const modal = document.getElementById("modal"),
        modalSeriesInfo = document.getElementById("modal-series-info"),
        modalSeasons = document.getElementById("modal-seasons"),
        closeModalBtn = document.getElementById("closeModalBtn");

      function openModal(series) {
        modal.classList.remove("hidden");

        modalSeriesInfo.innerHTML = `

<h2>${series.title}</h2>

<p><strong>Genre:</strong> ${series.genre}</p>

<p><strong>Language:</strong> ${series.language || "Unknown"}</p>

<p><strong>Rating:</strong> ${series.rating || "N/A"}</p>

<p><strong>Release Year:</strong> ${series.releaseyear || "N/A"}</p>

<p>${series.description || ""}</p>`;

        modalSeasons.innerHTML = "";

        if (Array.isArray(series.seasons) && series.seasons.length > 0) {
          const dropdown = document.createElement("select");

          dropdown.className = "season-dropdown";

          series.seasons.forEach((season, i) => {
            const option = document.createElement("option");
            option.value = i;
            option.textContent = season.name || `Season ${i + 1}`;
            dropdown.appendChild(option);
          });

          const episodesContainer = document.createElement("div");
          episodesContainer.className = "episodes-container";

          function renderEpisodes(idx) {
            episodesContainer.innerHTML = "";
            series.seasons[idx].episodes.forEach((ep) => {
              const epDiv = document.createElement("div");
              epDiv.className = "episode";
              epDiv.tabIndex = 0;
              epDiv.innerHTML = `<img src="${ep.thumbnail || ""}" alt="${
                ep.title
              }" class="episode-thumb"/><div class="episode-details"><div class="episode-title">${
                ep.title
              }</div><div class="episode-desc">${
                ep.description || ""
              }</div></div>`;
              epDiv.addEventListener("click", () => {
                const url = new URL(
                  "streamxmovie.html",
                  window.location.origin
                );
                url.searchParams.set("src", ep.src);
                url.searchParams.set("name", ep.title);
                window.location.href = url.toString();
              });
              episodesContainer.appendChild(epDiv);
            });
          }

          dropdown.addEventListener("change", (e) =>
            renderEpisodes(e.target.value)
          );

          modalSeasons.appendChild(dropdown);
          modalSeasons.appendChild(episodesContainer);
          renderEpisodes(0);
        } else {
          modalSeasons.innerHTML = "<p>No seasons available.</p>";
        }
      }

      function closeModal() {
        modal.classList.add("hidden");
      }

      closeModalBtn.addEventListener("click", closeModal);

      window.addEventListener("click", (e) => {
        if (e.target === modal) closeModal();
      });

      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && !modal.classList.contains("hidden"))
          closeModal();
      });

      // Live Cards Grid

      const livesContainer = document.getElementById("livesContainer");

      const MAX_SHOW = 30;

      function renderLiveCards(q = "") {
        const ch = window.channels || [];

        let res = ch.filter(
          (c) =>
            c.name.toLowerCase().includes(q.toLowerCase()) ||
            c.category.toLowerCase().includes(q.toLowerCase())
        );

        if (!q) res = res.slice(0, MAX_SHOW);

        livesContainer.innerHTML = res
          .map(
            (c) => `

<div class="live-card" style="--bg:url('${c.logo}')" onclick="window.open('${c.url}','_blank')">

<img src="${c.logo}" alt="${c.name}">

<div class="overlay">

<div class="overlay-content">

<div>${c.name}</div>

<div>${c.category}</div>

</div>

</div>

</div>`
          )
          .join("");
      }

      // initial build

      buildCarousel("seriesCarousel", seriesData, openModal);

      renderLiveCards();
    </script>
  </body>
</html>
