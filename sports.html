<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>FanCode Live Sports - Dynamic Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap"
        rel="stylesheet" />

    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

    <style>
        :root {
            --primary: #00e5ff;
            --bg-dark: #101320;
            --card-bg: #181b25;
            --live-color: #ff2263;
            --text-light: #e8e8ef;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background: var(--bg-dark);
            font-family: 'Space Grotesk', sans-serif;
            color: #fff;
        }

        main {
            padding: 1rem;
        }

        .movie-section {
            margin-bottom: 2.2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            border-left: 4px solid var(--primary);
            padding: 0.4rem 1rem;
            margin-bottom: 0.8rem;
            backdrop-filter: blur(8px);
        }

        /* Wrapper for grid and scroll buttons */
        .grid-wrapper {
            position: relative;
        }

        /* Your existing movie-container styles */
        .movie-container {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: 0.5rem;
        }

        .movie-container::-webkit-scrollbar {
            display: none;
        }

        .movie-card {
            flex: 0 0 auto;
            width: 320px;
            aspect-ratio: 16 / 9;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            position: relative;
            transition: transform 0.2s ease;
            cursor: pointer;
        }

        .movie-card:hover {
            transform: scale(1.03);
            z-index: 2;
        }

        .movie-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            border-radius: inherit;
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            opacity: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            padding: 1rem;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }

        .movie-card:hover .overlay,
        .movie-card:focus-within .overlay {
            opacity: 1;
            pointer-events: auto;
        }

        .title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.4rem;
        }

        .teams,
        .event {
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
            color: var(--text-light);
        }

        .time {
            font-size: 0.8rem;
            color: #c0efff;
            margin-top: 0.2rem;
        }

        .badge {
            margin-top: 0.6rem;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.3em 0.9em;
            border-radius: 20px;
            background: #444;
            color: #fff;
            display: inline-block;
        }

        .badge.live {
            background: var(--live-color);
        }

        @media (max-width: 768px) {
            .movie-card {
                width: 85vw;
            }

            .section-title {
                font-size: 1.2rem;
                padding: 0.3rem 0.8rem;
            }

            .overlay {
                padding: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .movie-card {
                width: 80vw;
                /* Already handled, but makes it even smaller */
                min-width: 140px;
                /* Prevent it from being too tiny */
            }
        }


        @media (max-width: 480px) {
            .title {
                font-size: 0.9rem;
            }

            .teams,
            .event,
            .time {
                font-size: 0.75rem;
            }
        }

        /* Scroll Buttons styles */
        .grid-scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgb(0, 0, 0);
            border: none;
            color: white;
            width: 39px;
            height: 39px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            user-select: none;
            transition: background-color 0.3s ease;
        }

        .grid-scroll-btn:hover:not(:disabled) {
            background: rgba(0, 0, 0, 0.8);
        }

        .grid-scroll-btn:disabled {
            opacity: 0.3;
            cursor: default;
        }

        .left-btn {
            left: 8px;
        }

        .right-btn {
            right: 8px;
        }

        @media (max-width: 480px) {
            .grid-scroll-btn {
                width: 28px;
                height: 28px;
            }
        }
    </style>
</head>

<body>
    <main>
        <div id="allCategoriesContainer"></div>
    </main>

    <script>
        const jsonUrl = "https://api.allorigins.win/raw?url=https://raw.githubusercontent.com/drmlive/fancode-live-events/main/fancode.json";
        const allCategoriesContainer = document.getElementById("allCategoriesContainer");

        function formatStartTime(str) {
            if (!str) return '-';
            const date = new Date(str);
            if (isNaN(date)) return str;
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function playChannel(match) {
            const streamUrl = match.adfree_url ?? match.dai_url;
            if (!streamUrl) {
                // Show a non-intrusive message for no stream available
                const msg = document.createElement('div');
                msg.className = 'error-message';
                msg.style.position = 'fixed';
                msg.style.bottom = '20px';
                msg.style.left = '50%';
                msg.style.transform = 'translateX(-50%)';
                msg.style.background = 'rgba(255, 0, 0, 0.8)';
                msg.style.color = '#fff';
                msg.style.padding = '10px 20px';
                msg.style.borderRadius = '4px';
                msg.style.zIndex = 10000;
                msg.textContent = 'No live stream available for this match.';
                document.body.appendChild(msg);
                setTimeout(() => msg.remove(), 3000);
                return;
            }
            const playerUrl = new URL("fancodeplayer.html", window.location.href);
            playerUrl.searchParams.set("src", streamUrl);
            playerUrl.searchParams.set("name", match.title);
            window.open(playerUrl.toString(), "_blank", "noopener,noreferrer");
        }

        function createMatchCard(match) {
            const card = document.createElement("div");
            card.className = "movie-card";
            card.tabIndex = 0;
            card.setAttribute('aria-label', `${match.title} - ${match.team_1 || ''} vs ${match.team_2 || ''}`);

            card.addEventListener('click', () => playChannel(match));
            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    playChannel(match);
                }
            });

            const poster = document.createElement("img");
            poster.src = match.src || "https://placehold.co/600x375?text=No+Image";
            poster.alt = match.title || "Match Image";
            poster.loading = 'lazy';

            const overlay = document.createElement("div");
            overlay.className = "overlay";

            const title = document.createElement("div");
            title.className = "title";
            title.textContent = match.title || "Untitled";

            const teams = document.createElement("div");
            teams.className = "teams";
            if (match.team_1 && match.team_2) {
                teams.textContent = `${match.team_1} vs ${match.team_2}`;
            } else if (match.match_name) {
                teams.textContent = match.match_name;
            }

            const event = document.createElement("div");
            event.className = "event";
            event.textContent = match.event_name || "";

            const time = document.createElement("div");
            time.className = "time";
            time.textContent = formatStartTime(match.startTime);

            const badge = document.createElement("span");
            badge.className = "badge";
            if (match.status === "LIVE") {
                badge.classList.add("live");
                badge.textContent = "LIVE";
            } else {
                badge.textContent = match.status || "";
            }

            overlay.appendChild(title);
            if (teams.textContent) overlay.appendChild(teams);
            if (event.textContent) overlay.appendChild(event);
            overlay.appendChild(time);
            overlay.appendChild(badge);

            card.appendChild(poster);
            card.appendChild(overlay);
            return card;
        }

        function createSection(titleText, matches) {
            const section = document.createElement("section");
            section.className = "movie-section";

            const title = document.createElement("div");
            title.className = "section-title";
            title.textContent = titleText;

            const wrapper = document.createElement("div");
            wrapper.className = "grid-wrapper";

            const container = document.createElement("div");
            container.className = "movie-container grid";

            matches.forEach(match => {
                const card = createMatchCard(match);
                container.appendChild(card);
            });

            wrapper.appendChild(container);
            section.appendChild(title);
            section.appendChild(wrapper);
            return section;
        }

        function addGridScrollButtons() {
            document.querySelectorAll(".grid-wrapper").forEach(wrapper => {
                const grid = wrapper.querySelector(".grid");
                if (!grid) return;

                wrapper.querySelectorAll(".grid-scroll-btn").forEach(btn => btn.remove());

                if (grid.scrollWidth <= grid.clientWidth + 1) return;

                const leftBtn = document.createElement("button");
                leftBtn.className = "grid-scroll-btn left-btn";
                leftBtn.setAttribute("aria-label", "Scroll Left");
                leftBtn.innerHTML = `<span class="material-icons">chevron_left</span>`;

                const rightBtn = document.createElement("button");
                rightBtn.className = "grid-scroll-btn right-btn";
                rightBtn.setAttribute("aria-label", "Scroll Right");
                rightBtn.innerHTML = `<span class="material-icons">chevron_right</span>`;

                leftBtn.addEventListener("click", () => {
                    grid.scrollBy({ left: -grid.clientWidth * 0.85, behavior: "smooth" });
                    setTimeout(updateButtons, 400);
                });

                rightBtn.addEventListener("click", () => {
                    grid.scrollBy({ left: grid.clientWidth * 0.85, behavior: "smooth" });
                    setTimeout(updateButtons, 400);
                });

                function updateButtons() {
                    leftBtn.disabled = grid.scrollLeft < 10;
                    rightBtn.disabled = grid.scrollLeft + grid.clientWidth >= grid.scrollWidth - 10;
                }

                wrapper.appendChild(leftBtn);
                wrapper.appendChild(rightBtn);

                updateButtons();

                grid.addEventListener("scroll", updateButtons);
                window.addEventListener("resize", updateButtons);
            });
        }

        // Show loading indicator
        allCategoriesContainer.innerHTML = '<p style="text-align:center; color:#bbb;">Loading matches...</p>';

        fetch(jsonUrl)
            .then(res => res.json())
            .then(data => {
                const matches = Array.isArray(data.matches) ? data.matches : [];

                if (matches.length === 0) {
                    allCategoriesContainer.innerHTML = "<div style='color:#bbb; text-align:center; margin:20px;'>No matches found.</div>";
                    return;
                }

                const liveMatches = matches.filter(m => m.status === "LIVE" && (m.adfree_url || m.dai_url));
                const categorized = matches.reduce((acc, match) => {
                    const cat = match.event_category || "Other";
                    if (!acc[cat]) acc[cat] = [];
                    acc[cat].push(match);
                    return acc;
                }, {});

                allCategoriesContainer.innerHTML = "";

                if (liveMatches.length > 0) {
                    const liveSection = createSection("Live Now", liveMatches);
                    allCategoriesContainer.appendChild(liveSection);
                }

                Object.keys(categorized).sort().forEach(cat => {
                    const section = createSection(cat, categorized[cat]);
                    allCategoriesContainer.appendChild(section);
                });

                // Add scroll buttons after sections are added
                addGridScrollButtons();

            })
            .catch(err => {
                console.error("Failed to load JSON", err);
                allCategoriesContainer.innerHTML = '<p style="color: red; text-align:center;">Failed to load matches. Please try again later.</p>';
            });

    </script>
</body>

</html>